extensions:
  health_check:

receivers:
  otlp:
    protocols:
      grpc:
        endpoint: localhost:55680
        auth:
          oidc:
            # should match the "issuer" field in dex.yaml
            issuer_url: https://127.0.0.1:5556/dex
            audience: test
            issuer_ca_path: ./test/certs/ca.pem
            username_claim: email

processors:
  # this processor will read an env var named OTEL_RESOURCE (key=value,key2=value2) and add each key-value pair as a resource attribute
  resourcedetection:
    detectors:
      - env

  # this routing table will always route spans to the 'jaeger' exporter
  routing:
    default_exporters:
    - jaeger
    from_attribute: X-Tenant
    table:
    - value: test
      exporters:
      - jaeger

exporters:
  jaeger:
    endpoint: localhost:14250
    insecure: true

service:
  extensions: [health_check]
  pipelines:
    traces:
      receivers:
        - otlp
      processors:
        - resourcedetection
        - routing
      exporters:
        - jaeger
